# مدار سوئیچینگ ترایاک (Isolated TRIAC Switching Circuit)

## مقدمه: هدف این مدار چیست؟

هدف اصلی این مدار، ایجاد یک پل ارتباطی امن بین دنیای دیجیتالِ کم‌مصرف و دنیای آنالوگِ پرقدرت است. میکروکنترلرها در ولتاژ پایین کار می‌کنند و نمی‌توانند مستقیماً یک لامپ را کنترل کنند. این مدار به ما اجازه می‌دهد تا با یک پالس کوتاه از طرف میکروکنترلر، یک کلید الکترونیکی قدرتمند (**ترایاک**) را برای کنترل بار AC فعال کنیم.

این مدار به تنهایی یک کلید روشن/خاموش است، اما ترکیب آن با یک **مدار تشخیص عبور از صفر**، به میکروکنترلر این قابلیت را می‌دهد که با کنترل دقیق زمان روشن شدن ترایاک در هر نیم‌سیکل، مقدار توان تحویلی به بار را تنظیم کند.

---

## اجزای مدار

هر قطعه در این مدار نقش مشخصی دارد:

### **U3: MOC3021 (اپتوکوپلر با خروجی ترایاک)**

MOC3021 یک قطعه الکترونیکی از خانواده **اپتوکوپلرها (Optocouplers)** است. وظیفه اصلی آن، کنترل یک مدار با ولتاژ بالا (AC) با استفاده از یک سیگنال ولتاژ پایین (DC) به صورت کاملاً ایزوله و ایمن است.

این قطعه از دو بخش اصلی تشکیل شده که داخل یک پکیج قرار دارند اما هیچ اتصال الکتریکی با هم ندارند:
1.  **بخش ورودی (فرستنده):** یک **دیود نوری مادون قرمز (Infrared LED)**. این بخش به مدار کنترل شما (مانند میکروکنترلر) متصل می‌شود.
2.  **بخش خروجی (گیرنده):** یک کلید حساس به نور از نوع **ترایاک (Photo-TRIAC)**. این بخش در مدار قدرت AC قرار می‌گیرد و به گیت ترایاک اصلی متصل می‌شود.

ارتباط بین این دو بخش فقط از طریق نور برقرار می‌شود. این ویژگی که به آن **ایزولاسیون گالوانیک** می‌گویند، مهم‌ترین مزیت این قطعه است.

### **U4: L6004L3 (ترایاک قدرت)**

این قطعه، کلید اصلی قدرت است.

* **کلید دوطرفه:** **ترایاک (TRIAC)** یک قطعه نیمه‌هادی است که می‌تواند جریان را در هر دو جهت عبور دهد، بنابراین برای کار با ولتاژ متناوب (AC) ایده‌آل است.
* **گیت (Gate):** با اعمال یک جریان کوچک به پایه گیت آن، ترایاک روشن شده و اجازه عبور جریان بسیار بزرگتری را بین دو پایه اصلی خود MT1 و MT2 می‌دهد.
* **عملکرد Latching:** یک ویژگی مهم ترایاک این است که پس از فعال شدن، تا زمانی که جریان عبوری از آن به نزدیک صفر برسد (یعنی در انتهای هر نیم‌سیکل AC)، روشن باقی می‌ماند.

### **R6: 220Ω (مقاومت محدودکننده جریان ورودی)**

این مقاومت وظیفه حفاظت از LED داخلی اپتوکوپلر MOC3021 را بر عهده دارد. خروجی یک پین میکروکنترلر، جریانی بیش از حد مجاز برای این LED تولید می‌کند. R6 این جریان را به یک مقدار ایمن (معمولاً بین ۱۰ تا ۱۵ میلی‌آمپر) محدود می‌کند.

---

## نحوه عملکرد گام به گام

1.  **اعمال سیگنال کنترل:** یک سیگنال ولتاژ HIGH (مثلاً 5V) از پین میکروکنترلر به ورودی Opto-TRIAC اعمال می‌شود.
2.  **روشن شدن LED داخلی:** جریان از طریق مقاومت R6 عبور کرده و LED مادون قرمز داخل MOC3021 را روشن می‌کند.
3.  **فعال شدن درایور ترایاک:** نور تولید شده، فتو-ترایاک داخلی MOC3021 را فعال می‌کند. این فتو-ترایاک مانند یک کلید بسته عمل می‌کند.
4.  **اعمال جریان به گیت:** با بسته شدن کلید داخلی MOC3021، یک مسیر برای عبور جریان از خط Phase، از طریق مقاومت R7 و به سمت گیت ترایاک قدرت U4 ایجاد می‌شود.
5.  **روشن شدن ترایاک قدرت:** جریان گیت، ترایاک U4 را روشن (Trigger) می‌کند. اکنون U4 مانند یک کلید بسته قدرتمند عمل کرده و مسیر اصلی جریان AC را برای بار (مثلاً لامپ متصل به Lamp_P) برقرار می‌کند و لامپ روشن می‌شود.
6.  **باقی ماندن در حالت روشن:** ترایاک U4 تا پایان آن نیم‌سیکل AC روشن باقی می‌ماند، حتی اگر سیگنال کنترل ورودی قطع شود. در لحظه عبور ولتاژ از صفر، ترایاک به طور خودکار خاموش می‌شود.

---

## یکپارچه‌سازی با مدار تشخیص عبور از صفر (ساخت دیمر)

جادوی واقعی زمانی اتفاق می‌افتد که این دو مدار با هم کار کنند:

1.  مدار تشخیص عبور از صفر به میکروکنترلر اطلاع می‌دهد: "یک نیم‌سیکل جدید شروع شد!"
2.  میکروکنترلر بر اساس مقدار مورد نظر برای روشنایی (مثلاً یک ورودی از پتانسیومتر)، یک تأخیر زمانی کوتاه (مثلاً بین ۰ تا ۱۰ میلی‌ثانیه) را محاسبه می‌کند.
3.  پس از سپری شدن این تأخیر، میکروکنترلر یک پالس کوتاه به مدار سوئیچینگ ترایاک (همین مدار) ارسال می‌کند.
4.  ترایاک برای باقی‌مانده آن نیم‌سیکل روشن می‌شود.

با تغییر این تأخیر، ما کنترل می‌کنیم که چه بخشی از موج AC به لامپ برسد و در نتیجه روشنایی آن را کنترل می‌کنیم.