# دیمر دیجیتال AC ایزوله (AC Digital Dimmer)

این نخستین مرحله از طراحی دیمر دیجیتال بر اساس تکنیک **کنترل زاویه فاز (Phase Angle Control)** به صورت پیشران، برای لامپ‌های‌رشته‌ای میباشد.
هدف، ساخت یک دستگاه کنترلی است که بتواند به صورت ایمن و دقیق، توان متوسط بار تحویل داده شده با لامپ را با یک سیگنال دیجیتال ولتاژ پایین تنظیم کند. برای رسیدن به این هدف، سه چالش اصلی را باید حل کنیم:

1.  **ایمنی:** جداسازی کامل مدار کنترل از ولتاژ کشنده شبکه.
2.  **زمان‌بندی:** پیدا کردن یک نقطه مرجع زمانی دقیق در موج سینوسی AC.
3.  **کنترل:** ایجاد یک مکانیزم برای "برش دادن" موج AC در یک نقطه دلخواه.

---

## اجزای مدار

سیستم از سه بلوک اصلی تشکیل شده است: مدار تشخیص عبور از صفر، مدار سوئیچینگ ترایاک، و واحد کنترل مرکزی:

### ۱. مدار تشخیص عبور از صفر (ZCD) - حل چالش زمان‌بندی

* **هدف:** ایجاد یک پالس‌مرجع‌دقیق، همزمان با هربارعبورولتاژ AC از صفر. این پالس، نقطه شروع محاسبات زمانی ماست.
* **نحوه عملکرد:** ولتاژ AC ورودی پس از تضعیف و فیلتر شدن، توسط یک دیود پل (BR1) به یک موج DC پالسی تبدیل می‌شود. این موج، LED داخلی اپتوکوپلر PC817 را روشن می‌کند. دقیقاً در لحظه عبور از صفر، این موج DC نیز به صفر رسیده و LED خاموش می‌شود. خاموش شدن LED، فتوترانزیستور را خاموش کرده و مقاومت Pull-up (R5) یک پالس HIGH در خروجی ایجاد می‌کند.

#### چرا این طراحی؟ (منطق انتخاب قطعات):

* **دیود پل (BR1):** موج AC دو نیم‌سیکل مثبت و منفی دارد، اما LED فقط با یک پلاریته کار می‌کند. دیود پل با **یک‌سو کردن تمام-موج**، به ما اجازه می‌دهد هر دو عبور از صفر در یک سیکل را تشخیص دهیم. این کار وضوح (Resolution) کنترل ما را دو برابر کرده و به عملکردی نرم‌تر منجر می‌شود.
* **اپتوکوپلر (PC817):** وظیفه این قطعه، صرفاً ترجمه وضعیت جریان در سمت ولتاژ بالا به یک سیگنال منطقی در سمت ولتاژ پایین است. PC817 یک انتخاب ایده‌آل است زیرا ارزان، در دسترس و برای این کار ساده (ایجاد یک پالس دیجیتال) کاملاً کافی و قابل اطمینان است. همچنین این اپتوکوپلر با فراهم اوردن **ایزولاسیون گالوانیک**، یعنی عدم وجود هرگونه اتصال فیزیکی، باعث ایجاد ایمنی می شود.

---

### ۲. مدار سوئیچینگ ترایاک - حل چالش کنترل

* **هدف:** دریافت یک فرمان دیجیتال کوتاه از میکروکنترلر و باز کردن مسیر جریان اصلی برای بار AC.
* **نحوه عملکرد:** پالس ارسالی از میکروکنترلر، LED داخلی اپتوکوپلر MOC3021 را روشن می‌کند. این کار باعث فعال شدن فتو-ترایاک داخلی شده و این فتو-ترایاک، جریان گیت مورد نیاز برای راه‌اندازی ترایاک قدرت (U4) را فراهم می‌کند.

#### چرا این قطعات انتخاب شده است؟

* **اپتوکوپلر (MOC3021):** این قطعه یک درایور تخصصی برای ترایاک است. مهم‌ترین ویژگی آن **Non-Zero-Crossing** بودن است. این یعنی به محض دریافت فرمان، خروجی را فعال می‌کند. این قابلیت برای کنترل زاویه فاز (دیمر) حیاتی است، زیرا به ما اجازه می‌دهد ترایاک را در هر لحظه دلخواهی از نیم‌سیکل "آتش" کنیم. انتخاب یک درایور Zero-Crossing در اینجا، کل پروژه دیمر را غیرممکن می‌ساخت.
* **ترایاک قدرت (L6004L3):** این قطعه کلید اصلی ماست. L6004L3 یک ترایاک با **"گیت حساس" (Sensitive Gate)** است، یعنی برای روشن شدن به جریان گیت کمی نیاز دارد. این ویژگی آن را گزینه‌ای عالی برای راه‌اندازی توسط یک اپتوکوپلر مانند MOC3021 می‌کند.

---

### ۳. واحد کنترل (آردوینو)

* **هدف:** اجرای منطق اصلی دیمر: دریافت پالس زمان‌بندی، خواندن ورودی کاربر، محاسبه تأخیر و ارسال فرمان نهایی. آردوینو به دلیل دردستر بودن در محیط پروتئوس، سادگی برنامه‌نویسی و پشتیبانی عالی از **وقفه‌ها (Interrupts)**، انتخابی ایده‌آل برای این کار است.

---

## اصول عملکرد کلی (کنترل زاویه فاز)

فرآیند کنترل در هر نیم‌سیکل (10,000 میکروثانیه برای برق 50Hz) به این صورت اجرا می‌شود:

1.  **تشخیص عبور از صفر:** مدار ZCD یک پالس به پین وقفه آردوینو ارسال می‌کند.
2.  **محاسبه تأخیر:** در این مرحله از پروژه، کاربر فقط می تواند از طریق یک پتانسیومتر، میزان روشنایی مورد نظر خود را تنظیم کند (در فازهای بعدی قابلیت های پیشرفته تری اضافه می شود). بدین صورت که آردوینو در حلقه loop به طور مداوم مقدار پتانسیومتر را می خواند و براساس ان، یک تاخیر زمانی در بازه 1500 تا 8000 میکروثانیه برای فعال سازی ترایاک، محاسبه می کند.
3.  **اجرای وقفه:** با دریافت پالس ZCD، آردوینو اجرای برنامه اصلی را متوقف کرده و تابع وقفه را فراخوانی می‌کند.
4.  **ایجاد تأخیر و آتش:** تابع وقفه ابتدا به اندازه dimmingDelay محاسبه شده، صبر می‌کند و سپس یک پالس کوتاه به MOC3021 ارسال کرده و ترایاک را روشن می‌کند.
5.  **روشن ماندن و خاموشی خودکار:** ترایاک به لطف عملکرد Latching، تا انتهای آن نیم‌سیکل روشن باقی می‌ماند. با رسیدن جریان به صفر، ترایاک به طور خودکار خاموش شده و منتظر فرمان بعدی در نیم‌سیکل بعدی می‌ماند.